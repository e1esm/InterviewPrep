### Docker - инструмент для сборки пакетов, поставки и запуска приложений в "контейнерах".

Контейнер - это базовая единица ПО, покрывающая код и все его зависимости для обеспечения запуска приложения прозрачно, быстро, надежно независимо от окружения. Контейнер создается на основе образа Docker. Это исполняемый пакет ПО, содержащий все необходимое для запуска приложения, например, системные программы, библиотеки, код, среды исполнения и настройки.


### Архитектура Docker:
- Сервер - содержит сервис Docker, образы и контейнеры, связывающийся с Registry. (Образы - это методанные приложений, запускаемых в контейнерах Docker)
- Клиент - применяется для запуска различных действия на сервере Docker
- Registry - используется для хранения образов. Есть публичные - Docker Hub, Docker Cloud.


### Registry (Docker Hub) - система хранения образов контейнеров, поддерживаемая много разработчиками.

### Жизненный цикл контейнера Docker:
- Создание контейнера
- Работа контейнера
- Приостановка контейнера
- Возобновление работы контейнера
- Запуск контейнера
- Остановка контейнера
- Перезапуск контейнера
- Принудительная остановка контейнера
- Удаление контейнера


### Наиболее часто-используемые команды Docker:
- build - сборка образа для Docker
- create - создание нового контейнера
- kill - принудительная остановка контейнера
- dockerd - запуск сервиса Docker
- commit - создание нового образа из изменений в контейнере


### Пространства имен в Docker:
Пространство имен в Docker - технология обеспечения изолированных пространств - контейнер. При создании контейнера создается набор пространств имен для этого контейнера. Они обеспечивают уровень изоляции для контейнеров, т.к. каждый контейнер работает в отдельном пространстве с ограничением доступа к другим пространствам.


### Вывод состояния контейнеров: 
`docker ps -a` - Вывод информации:
- Название контейнера
- ID контейнера
- Состояние
- Дата создания
- Дата поднятия
- Команда запуска Entrypoint
- Проброшенные порты


### Образ Docker:
это набор файлов, соединенный с настройками, с помощью которых можно создать экземпляры, которые запускаются в отдельных контейнерах в виде изолированных процессов. Образ строится с использованием инструкций для получения полной исполняемой версии приложения, зависящей от версии ядра сервера. Docker run - команда для создания контейнеров, запускаемых с использованием образов. Образ может быть использован для нескольких контейнеров.


### Юзкейсы Docker:
- Упростить настройку на уровне инфраструктуры
- Помочь разработчика сосредоточиться исключительно на коде
- Изолировать приложения
- Улучшить плотность использования серверов в форме контейнеризации
- Быстрое развертывание

### Объекты Docker:
- Образы - шаблоны с инструкциями только для чтения для создания контейнеров
- Контейнеры - запущенные экземпляры образов
- Сети
- Тома

### Stateful vs Stateless для Docker:
Приложения без хранения состояния(stateless) больше подходят для работы в Docker.
Если хранения состояния нет - можно использовать один и тот же образ в разных сценариях, а также проще масштабировать.


### Dockerfile:
Dockerfile - файл с инструкциями для сборки образов, которые передаются в Docker.


### Доступные сети по умолчанию:
-  bridge - сеть, к которой подключаются контейнеры, если не указано иначе - позволяет контейнерам, присоединенным к одной сети коммуницировать, изолирую от контейнеров, подключенных к другой сети.
- none - сетевой стек без наличия сетевого интерфейса в контейнере
- host - подключение к сетевому стеку сервера - удаляет изолированность между контейнерами и хостом.


### Отличие Docker от других технологий контейнеризации.
Docker позволяет работать с любой инфраструктуры, неважно, дома она или в облаке. Хорошо задокументирован и легко получать необходимые образы из DockerHub.


## Остановка контейнера:
- Данные не будут потеряны, поскольку все данные пишутся приложением на диск с целью хранения. Файловая система контейнера также хранит изменения после полной остановки контейнера. Этот происходит до того момента, пока контейнер не удален.

## Проверка потребления ресурсов контейнера:
`docker stats` - возвращает ID, имя, потребления памяти, CPU, трафика контейнера.


## Краткая работа с Docker:
- Написание Dockerfile
- Сборка образа контейнера, который можно также распространить
- Образ используется для запуска контейнеров. 
- Контейнер запускается. Контейнер похож на VM, без гипервизора


### docker run vs docker create:
- `docker run` - собирает контейнер и запускает его
- `docker start` - собирает контейнер и не запускает его


### Виртуализация:
Виртуализация - способ логического разделение мейнфреймов для обеспечения одновременной работы нескольких приложений. Со временем, появилась возможность одновременной работы нескольких операционных систем на одном сервере и смысл виртуализации поменялся.
С помощью виртуализации можно запустить две различных операционных системы на одном оборудовании.

### Типы виртуализации:
- Паравиртуализация
- Эмуляция
- Контейнерная виртуализация

### CMD и ENTRYPOINT в Dockerfile:
Эти инструкции задают команду, исполняемую при запуске контейнера. При их использовании есть правила:
- Должна присутствовать либо команда CMD либо ENTRYPOINT в Dockerfile.
- Если контейнер используется как исполняемый файл - ENTRYPOINT должна быть определена
- Если контейнер будет запускаться с другими аргументами - CMD будет переопределена


### Гипервизор:
Гипервизор - это ПО  для создания и запуска виртуальных машин. Он служит для запуска нескольких гостевых ОС, что достигается благодаря разделению ресурсов.
Типы гипервизора:
   - Легковесная операционная система, запускаемая на оборудовании
   - ПО, запускаемое из ОС



### Виртуализация vs Контейнеризация:
- Виртуализация - запускает несколько ОС на одном физическом сервере
- Контейнеризация - работает на одной и той же ОС, в которой приложения упакованы в контейнере и запускаются на одном сервере/VM.

![[Pasted image 20230921211916.png]]

### Кэширование образов:
Образы многослойно кэшируются, что позволяет увеличить скорость дальнейшей сборки контейнера.

## Наиболее частые команды в Docker
- docker push - загрузить репозиторий или образ в Registry
- docker run - запустить новый контейнер
- docker pull - скачать репозиторий или образ из Registry
- docker start - запустить один или несколько контейнеров
- docker stop - остановить один или несколько контейнеров
- docker search - поиск образа на DockerHub
- docker commit - сохранить изменения в новый образ


### Платформы, поддерживаемые Docker:
- Windows (x86_64)
- Linux(x86_64, ARM)


### Перезапуск контейнера:
- Off: контейнер не будет перезапущен если он остановится или аварийно завершит работу
- On-failure: контейнер перезапустится, если будет аварийно остановлен
- Unless-stopped: перезапуск будет работать до тех пор, пока пользователь не остановит
- Always: перезапуск в любом случае, независимо от ошибок или других проблем

### Возможные состояния контейнеров:
- Created - контейнер создан, но не активен
- Restarting - контейнер в процессе перезапуска
- Running - контейнер работает
- Paused - контейнер приостановлен
- Exited - контейнер закончил работу
- Dead - контейнер, который сервис попытался остановить, но он не смог



### Оркестрация:
Оркестрация служит для управления большим количеством контейнеров, запущенных в динамических окружениях. Она позволяет автоматизировать и управлять следующими задачами:
- Создание и развертывание контейнеров
- Балансировка нагрузки
- Разделение ресурсов между контейнерами
- Мониторинг контейнеров и серверов
- Масштабирование контейнеров
- Перенос контейнера с одного сервера на другой, если возникает недостаток ресурсов.


### Тома в Docker:
Тома, создаваемые и управляемые Docker хранятся в файловой системе сервера Docker по пути `var/lib/docker/volumes`. Тома - наиболее эффективный способ сохранения данных в Docker.

### Продвинутые команды Docker:
- `docker -version`
- `docker ps` - вывод запущенных контейнеров с доп информацией по ним
- `docker ps -a`
- `docker exec` - войти в контейнер и выполнить в нем команду
- `docker build` - собрать образ из Dockerfile
- `docker rm` - удалить контейнер с указанным идентификатором
- `docker rmi` - удалить контейнер и образ с указанным идентификатором
- `docker cp` - сохранить файл из контейнера в локальную систему
- `docker history` - показать историю образа с указанным именем



## Масштабирование контейнеров Docker:
Контейнеры могут быть масштабированы с помощью команды:
`docker-compose scale`
`docker-compose --file docker-compose.yml scale <service_name>=<n>`


### CNM:
Container Network Model - описание, формально определяющее шаги, требуемые для предоставления сети контейнерам, где обслуживающая абстракция применяется для поддержки нескольких сетевых драйверов. 


### Типы монтирования в Docker:
- Bind mount - подключается к любой точке файловой системы сервера
- Volume mount - управляются Docker и хранятся как часть файловой системы сервера.
- tmpfs mount - хранятся в оперативной памяти сервера, поэтому никогда не пишутся в реальную систему.

### Docker trusted Registry:
Хранилище образов для безопасного хранения и управления образами Docker. Его можно установить на своих мощностях, либо в частном облаке, применяется в процессах CI/CD для сборки, поставки и запуска приложений.


### Docker_host:
Задает URL или путь к сокету unix, которое используется для соединения с API Docker. Значение по умолчанию: `unix://var/run/docker.sock`
Для подключения по TCP: `tcp://192.0.1.20:3230`