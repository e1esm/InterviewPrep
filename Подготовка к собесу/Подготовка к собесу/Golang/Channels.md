Каналы служат для синхронизации между горутин.

## Каналы:
- У каналов есть размер. Можно создать канал размером N. Даже небуферизированный канал будет обладать размером, равным 0.
- Служат для передачи данных между горутин.
- Потоко-безопасны.
- FIFO - работает как очередь. 
- Горутины ждут каналы - канал может заставить горутину ждать при запросе элемента из канала или при записи в канал.
- Каналы могут заблокировать горутины.

Действия с каналами:
- Создание
- Запись
- Прочтение
- Закрытие

## Канал состоит из:
- hchan - структура, которая содержит основные данные
- sudog - структура со специальными полями, нужная для работы каналов, select и.т.д.
- waitq - структура, представляющая собой linkedlist, хранящая два указателя на голову и хвост.

При создании канала:
`plate := make(chan string, 3)`
Создается структура, которая содержит в себе 10 полей, одно из которых - Ring Buffer, где хранятся наши данные.

Кольцевой буфер строится на основе массива и двух указателей(индексах). Один индекс постоянно инкрементируется с появлением новых данных, а другой инкрементируется при прочтении. Когда достигается конец - индексы возвращаются в начало.

В случае, когда буфер переполняется и нет возможности писать в канал - выстраивается очередь из горутин.


Также, в канале есть recvq и sendq - листы ожидания на чтение и запись.

Канал находится в динамической области памяти (Heap)

Небуферизированный канал создается с буфером значения nil. Все горутины, желающие прочтения из него встают в очередь, а как только появляется пишущая горутина - она передает данные первой ожидающей горутине. Если читающих нет - пишущая так же встает в очередь.


## Пример: есть небуферизированный канал, в который пишут две горутины. первая вписывает кота, вторая собаку: Третья горутина читает один элемент из канала. Итог:
![[Pasted image 20230921172808.png]]



Операции с каналами:
![[Pasted image 20230921180915.png]]


## Работа select:
- Case сортируется - быстрый рандом, который сортирует все кейсы по определенному правилу. Если горутина готова прочитать из нескольких каналов - нужный канал будет выбран на основе этой сортировки.
- Если select ни может прочесть ни из одного канала - выполняется либо default case, либо она блокируется.