Map - тип данных, хранящий элементы в форме словаря. Сложность операций - O(1) - за счет того, что мапа старается равным образом раскидать все элементы по бакетам. В бакеты элементы отправляются после хэширования ключа.

Элемент поступает в определенный бакет по следующему алгоритму:
1) Берется хэш от ключа
2) От полученного хэша берут остаток от деления (от количества бакетов) - поулченный результат и будет являться бакетом, куда пололожится текущая запись. 

Структура бакета:
В каждом бакете есть не больше 8 HOB Hash - high order bits - для быстрого определения, есть ли требуемый ключ в данном бакете. 
Ключи и значения в бакете хранятся в обычном массиве, разделенные пустыми элементами.
![[Pasted image 20230921012256.png]]

Переполнение бакета:
Если в бакет нужно поместить 9ое значение - создается новый бакет и ссылка на него присваивается к предыдущему бакету. Подобная ситуация нежелательна из-за проблематичности вычислений в дальнейшем.


Рост map при заполнении:
Мапа может так же увеличиваться в размерах - память для нее будет выделяться тогда - когда % overflow бакетов составляет 20.

При росте map происходит эвакуация данных - создается новый список бакетов, который будет в 2 раза больше предыдущего и все элементы будут скопированы в новые бакеты. Операции переноса выполняются тогда, когда происходит операция сохранения или удаления ключа из мапы.  Решить эту проблему можно путем выделения нужного количества памяти при инициализации.

Нельзя взять указатель на ключ мапы из-за того, что может произойти эвакуация данных и ссылка будет невалидной.

Порядок обхода мапы случаен. Итератор ходит по бакетам - новым и старым(если была эвакуация) - чтобы это не было камнем преткновения разработчикам - обход начинается каждый раз со случайного элемента мапы.